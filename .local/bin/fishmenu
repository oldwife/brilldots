#!/bin/bash
source ~/.cache/wal/colors.sh
#dmenucmd="dmenu -sb $color6 -sf $background -nf $color3 -nb $color4 -bw 1"
dmenucmd="dmenu -sb $color0 -sf $color5 -nf $color0 -nb $color5 -bw 0 -l 20 -W 200 -Y 20"

mainmenu() {
CHOICES=$(echo -e "log/shut\npacman\nnetwork\ndisplay\naudio\ntheme\nusb\nbluetooth\nkeys\nesc=out" | $dmenucmd )

case "$CHOICES" in
	log/shut) shutdownfunc ;;
	pacman) pacmansettings ;;
	network) st -e sudo nmtui ;;
	display) displaysettings ;;
	audio) st -e pulsemixer ;;
	theme) theme ;;
	#theme) fishwalldwm ;;
	bluetooth) blueberry ;;
	usb) st -e bashtop ;;
	keys) keys ;;
esac
}

keys() {
[[ -f ~/.Xmodmap ]] && xmodmap ~/.Xmodmap &
xset r rate 300 50 &
xcape -e 'Super_L=Escape' &
xcape -e 'Super_R=Escape'
}

shutdownfunc() {
powerchoice=$(echo -e "logoff\nshutdown\nrestart\nesc=.." | $dmenucmd )

case "$powerchoice" in
	logoff)       dwmc quit                          ;;
	shutdown)     shutdown now                       ;;
	restart)     shutdown now                       ;;
	*) mainmenu ;;
esac
}

pacmansettings() {
PCHOICES=$(echo -e "install\nuninstall\nupdate\naur\nesc=.." | $dmenucmd )
case "$PCHOICES" in
	install) st -e fzpacins         ;;
	uninstall) st -e fzpacun        ;;
	update) st -e sudo pacman -Syyu ;;
	aur) st -e fzyay ;;
	*) mainmenu ;;
esac
}

displaysettings() {
screenopts=$(echo -e "displayopts\nscreenpwr\nesc=.." | $dmenucmd )
case "$screenopts" in
	displayopts) xset -dpms s off | arandr ;;
	screenpwr) powersettings ;;
	*) mainmenu ;;
esac
}

powersettings() {
PCHOICES=$(echo -e "screensleepon\nscreensleepoff\nesc=.." | $dmenucmd )
case "$PCHOICES" in
	screensleepon) xset -dpms s on         ;;
	screensleepoff) xset -dpms s off       ;;
	*) displaysettings ;;
esac
}

theme() {
CHOICES=$(echo -e "random\ncustom" | $dmenucmd )
case "$CHOICES" in
	random)    wal --theme random                                        ;;
	custom)    $TERMINAL -e fzwal ;;
esac

cp ~/.cache/wal/suggestions.xml ~/testmount/Phone/t-ui/suggestions.xml
cp ~/.cache/wal/theme.xml ~/testmount/Phone/t-ui/theme.xml
cp ~/.cache/wal/notifications.xml ~/testmount/Phone/t-ui/notifications.xml
cp ~/.cache/wal/colors-qutebrowserduckduck.py ~/.config/qutebrowser/duckduckgocolors.py 
dwmc xrdb 
kill -44 $(pidof dwmblocks)
solidwallpaper
}

steam() {
choice=$(find ~/.steam/steam/steamapps -maxdepth 1 -type f -name '*.acf' -exec awk -F '"' '/"name/{ printf $4 "|" } END { print "" }' {} \; | column -t -s '|' | sort -k 2 | grep -v 'Steam\|Proton' | $dmenucmd )

choicep=$(find ~/.steam/steam/steamapps -maxdepth 1 -type f -name '*.acf' -exec awk -F '"' '/"appid|name/{ printf $4 "|" } END { print "" }' {} \; | column -t -s '|' | sort -k 2 | grep "$choice" | tr -d "$choice" )

if [[ -z $choice ]]; then exit
else steam steam://run/$choicep
fi
}

case "$1" in
	log/shut) shutdownfunc ;;
	pacman) pacmansettings ;;
	network) st -e sudo nmtui ;;
	display) displaysettings ;;
	audio) st -e pulsemixer ;;
	theme) theme ;;
	bluetooth) blueberry ;;
	usb) st -e bashtop ;;
	keys) keys ;;
	steam) steam ;;
	*) mainmenu
esac
