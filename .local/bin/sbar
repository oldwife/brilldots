#!/bin/env sh
source ~/.cache/wal/colors.sh

time="$(date '+%H:%M')" 

ad=$(acpi -a | grep -wo "on-line\|off-line")
bp=$(acpi -b | grep "Battery 0" | grep -o '[0-9]\+%' | tr -d '%')
be="$( printf '%x\n' $bp )"

if [[ $bp -ge "80" ]]; then be='#'
fi
if [[ $ad = "on-line" ]]; then ch='#'
else ch='<'
fi
	bat="$ch$be"

volume=$( pamixer --get-volume)
volumefix=$( printf '%x\n' $volume )
mute=$([ "$(pamixer --get-mute)" = "false" ] && printf '*' || printf '$')

if [[ $volume = "0" ]]; then volumefix="$"
fi

vol="$mute$volumefix"

wf=$(nmcli -g GENERAl.STATE device show | grep -wo -m 1 "connected\|disconnected")
ss=$(iw dev wlp59s0 link | grep 'dBm$' | grep -Eoe '-[0-9]{2}' | awk '{print  ($1 > -50 ? 100 :($1 < -100 ? 0 : ($1+100)*2))}')

if [[ $wf = "connected" ]]; then wi="@@"
else wi="@~"
fi
	
networking=" $wi"

xsetroot -name " ^c$color3^^b$color4^  $vol  ^c$color4^^b$color3^  $bat  ^c$color5^^b$color2^ $networking  ^c$color2^^b$color5^ $time "
